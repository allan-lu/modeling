---
title: "Homework 6"
author: "Allan Lu"
date: "March 17, 2020"
output: 
  html_document:
    df_print: paged
    toc: yes
  html_notebook:
    df_print: paged
    toc: yes
---


# Loading Libraries
Load in necessary libraries in one chunk.

```{r loading in libraries, warning=FALSE, message=FALSE}
library(tidyverse)
library(knitr)
library(stringr)
library(magrittr)
library(dplyr)
```


# Number of Swimmers in Each House

Find out which house in Hogwarts has the most swimmers in the swimming database.

```{r read and join data, warning=FALSE, message=FALSE}
houses_df <- read_csv("Hogwarts_House_Students.csv")
swims_df <- read_csv("Hogwarts_swimming_2019_20.csv")

swims_df %<>%
  left_join(houses_df, by="ENTRIES")
```

```{r group and count}
swimmers_df <- swims_df %>%
  select(ENTRIES, HOUSE = House.name) %>%
  distinct() %>%
  group_by(HOUSE) %>%
  count(HOUSE, name="NUMBER_SWIMMERS")

swimmers_df
```
Gryffindor is the Hogwarts house with the most swimmers.


# Points per Swimmer

Find the points won per swimmer for each of the houses in Hogwarts.

```{r recaculate points, warning=FALSE, message=FALSE}
relays <- swims_df %>%
  filter(grepl("RELAY", EVENT)) %>%
  mutate(new_PTS = ifelse(PL == 1, 8/4, 
                          ifelse(PL == 2, 4/4, 
                                 ifelse(PL == 3, 2/4, 
                                        0))))

races_df <- swims_df %>%
  filter(!grepl("RELAY", EVENT)) %>%
  mutate(new_PTS = ifelse(PL == 1, 6,
                          ifelse(PL == 2, 4,
                                 ifelse(PL == 3, 3,
                                        ifelse(PL == 4, 2,
                                               ifelse(PL == 5, 1, 
                                                      0)))))) %>%
  rbind(relays) %>%
  drop_na()
```


```{r add points columns, warning=FALSE, message=FALSE}
points_df <- races_df %>%
  select(HOUSE = House.name, new_PTS) %>%
  group_by(HOUSE) %>%
  summarize(TOTAL_POINTS = sum(new_PTS)) %>%
  left_join(swimmers_df, by="HOUSE") %>%
  mutate(PTS_PER_SWIMMER = TOTAL_POINTS / NUMBER_SWIMMERS)

points_df
```


# Top 10 Fastest
Find the top 10 fastest swimmers in the `100 FREE`. 

```{r parse time, warning=FALSE, message=FALSE}
library(lubridate)

time_df <- swims_df %>%
  drop_na() %>%
  select(EVENT, ENTRIES, TIME, Date, Against, 
         HOUSE = House.name) %>%
  mutate(seconds = TIME %>% ms() %>% seconds() %>% as.numeric()) %>%
  filter(EVENT == "100 FREE") %>%
  top_n(-10, seconds) %>%
  arrange(seconds) %>%
  select(-seconds)

time_df
```

